:original_name: cbr_03_0025.html

.. _cbr_03_0025:

Creating a Backup Policy
========================

A backup policy allows a vault to automatically execute backup tasks at specified times or intervals. Periodic backups can be used to restore data quickly against data corruption or loss.

To implement periodic backup, you need to create a backup policy first. CBR will then periodically perform backups according to the execution time specified in the backup policy. You can choose to use the default backup policy provided by CBR or create one as needed.

You can apply backup policies to server backup vaults and disk backup vaults.

Background Information
----------------------

-  After a backup policy is enabled, CBR automatically backs up resources associated with the vaults that have been associated with the policy and periodically deletes expired backups.
-  Each account can create a maximum of 32 backup policies.
-  When expired backups are cleared based on a policy's retention rules, only automatic backups will be deleted. Manual backup will not be deleted.
-  Only servers in the **Running** or **Stopped** state can be backed up.
-  Only disks in the **Available** or **In-use** state can be backed up.

Procedure
---------

#. Log in to CBR Console.

   a. Log in to the management console.
   b. Click |image1| in the upper left corner and select your region and project.
   c. Choose **Storage** > **Cloud Backup and Recovery**. Select a backup tab from the left navigation pane.

#. Choose **Policies** and click the **Backup Policies** tab. In the upper right corner, click **Create Policy**. See :ref:`Figure 1 <cbr_03_0025__fig83663164139>`.

   .. _cbr_03_0025__fig83663164139:

   **Figure 1** Creating a backup policy

   |image2|

#. Set the backup policy parameters. :ref:`Table 1 <cbr_03_0025__table18975142115146>` describes the parameters.

   .. _cbr_03_0025__table18975142115146:

   .. table:: **Table 1** Backup policy parameter description

      +-----------------------+------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
      | Parameter             | Description                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  | Example Value                                                                                                                                                                                                                                                      |
      +=======================+==============================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================+====================================================================================================================================================================================================================================================================+
      | Type                  | Select a policy type. This section uses creating a backup policy as an example.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              | Backup policy                                                                                                                                                                                                                                                      |
      +-----------------------+------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
      | Name                  | Backup policy name                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           | backup_policy                                                                                                                                                                                                                                                      |
      |                       |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              |                                                                                                                                                                                                                                                                    |
      |                       | A name must contain 1 to 64 characters including digits, letters, underscores (_), or hyphens (-).                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           |                                                                                                                                                                                                                                                                    |
      +-----------------------+------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
      | Status                | Whether to enable the backup policy.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         | Only after a backup policy is enabled will CBR automatically backs up servers and disks associated with the vaults applied with the policy and deletes expired backups.                                                                                            |
      +-----------------------+------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
      | Execution Time        | Execution time                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               | 00:00, 02:00                                                                                                                                                                                                                                                       |
      |                       |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              |                                                                                                                                                                                                                                                                    |
      |                       | Backups can be scheduled at the beginning of each hour. Multiple selections are supported.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   | It is recommended that backups be performed during off-peak hours or when there are no services running.                                                                                                                                                           |
      |                       |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              |                                                                                                                                                                                                                                                                    |
      |                       | .. important::                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               |                                                                                                                                                                                                                                                                    |
      |                       |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              |                                                                                                                                                                                                                                                                    |
      |                       |    NOTICE:                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   |                                                                                                                                                                                                                                                                    |
      |                       |    If you want to back up a large amount of data, you are advised to set a less frequent backup schedule. If a backup task takes longer than the backup interval, the system will skip the next backup execution time.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       |                                                                                                                                                                                                                                                                    |
      |                       |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              |                                                                                                                                                                                                                                                                    |
      |                       |    For example, as scheduled in a backup policy, a disk needs to be backed up at 00:00, 01:00, and 02:00. At 00:00, the disk starts being backed up. Because the high-volume incremental data needs to be backed up or a heap of backup tasks are executed at the same time, this backup task takes 90 minutes and completes at 01:30. In this case, the system performs the next backup at 02:00. Therefore, only two backups will be generated in total, one at 00:00, and the other at 02:00.                                                                                                                                                                                                                                                                                                                             |                                                                                                                                                                                                                                                                    |
      +-----------------------+------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
      | Backup Cycle          | Dates for performing backups                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 | Every day                                                                                                                                                                                                                                                          |
      |                       |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              |                                                                                                                                                                                                                                                                    |
      |                       | -  **Week-based cycle**                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      | If you select day-based backup, the first backup time is supposed to be on the day the backup policy is created. If the creation time of the backup policy is later than the latest execution time, the initial backup will be performed in the next backup cycle. |
      |                       |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              |                                                                                                                                                                                                                                                                    |
      |                       |    Specifies on which days of each week the backup task will be executed. You can select multiple days.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      | It is recommended that backups be performed during off-peak hours or when there are no services running.                                                                                                                                                           |
      |                       |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              |                                                                                                                                                                                                                                                                    |
      |                       | -  **Custom cycle**                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          |                                                                                                                                                                                                                                                                    |
      |                       |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              |                                                                                                                                                                                                                                                                    |
      |                       |    Specifies the interval (every 1 to 30 days) for executing the backup task.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                |                                                                                                                                                                                                                                                                    |
      +-----------------------+------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
      | Retention Rule        | Rule that specifies how backups will be retained                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             | 6 months                                                                                                                                                                                                                                                           |
      |                       |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              |                                                                                                                                                                                                                                                                    |
      |                       | -  **Time period**                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           |                                                                                                                                                                                                                                                                    |
      |                       |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              |                                                                                                                                                                                                                                                                    |
      |                       |    You can choose to retain backups for one month, three months, six months, one year, or for any desired number (2 to 99999) of days.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       |                                                                                                                                                                                                                                                                    |
      |                       |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              |                                                                                                                                                                                                                                                                    |
      |                       | -  **Backup quantity**                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       |                                                                                                                                                                                                                                                                    |
      |                       |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              |                                                                                                                                                                                                                                                                    |
      |                       |    You can set the maximum number of cloud server backups to retain for one cloud server. The value ranges from 2 to 99999.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  |                                                                                                                                                                                                                                                                    |
      |                       |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              |                                                                                                                                                                                                                                                                    |
      |                       | -  You can also set long-term retention rules with advanced options. Long-term retention rules and quantity-based retention rules do not conflict. They will both be applied.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                |                                                                                                                                                                                                                                                                    |
      |                       |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              |                                                                                                                                                                                                                                                                    |
      |                       |    -  **Day-based**: The value ranges from **0** to **100**.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 |                                                                                                                                                                                                                                                                    |
      |                       |    -  **Weekly**: The value ranges from **0** to **100**.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    |                                                                                                                                                                                                                                                                    |
      |                       |    -  **Monthly**: The value ranges from **0** to **100**.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   |                                                                                                                                                                                                                                                                    |
      |                       |    -  **Yearly**: The value ranges from **0** to **100**.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    |                                                                                                                                                                                                                                                                    |
      |                       |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              |                                                                                                                                                                                                                                                                    |
      |                       |    For example, day-based advanced option retains the most recent backup by day. If a disk is backed up for multiple times in a day, only the most recent backup of that day is retained. If you set the value to 5, the system keeps the most recent backup from each of the last five days that have backups generated. If there are more than five backup files, the system automatically deletes the earliest backups. If the day-based, weekly, monthly, and yearly advanced options are all configured, the union backups are selected for retention. For example, if the number of retained day-based backups is set to 5 and the number of retained weekly backups is set to 1, five backups will be retained. The long-term retention rule and the quantity-based retention rule can be effective at the same time. |                                                                                                                                                                                                                                                                    |
      |                       |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              |                                                                                                                                                                                                                                                                    |
      |                       | -  **Permanent**                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             |                                                                                                                                                                                                                                                                    |
      |                       |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              |                                                                                                                                                                                                                                                                    |
      |                       |    .. note::                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 |                                                                                                                                                                                                                                                                    |
      |                       |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              |                                                                                                                                                                                                                                                                    |
      |                       |       -  When the number of retained backups exceeds the preset value, the system automatically deletes the earliest backups. When the retention periods of retained backups exceed the preset value, the system automatically deletes all expired backups. By default, the system automatically clears data every other day. The deleted backup does not affect other backups for restoration.                                                                                                                                                                                                                                                                                                                                                                                                                              |                                                                                                                                                                                                                                                                    |
      |                       |       -  This parameter applies only to backups generated based on a scheduled backup policy. Manual backups are not affected by this parameter and will not be automatically deleted. You can manually delete them from the backup list.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    |                                                                                                                                                                                                                                                                    |
      |                       |       -  After a backup is used to create an image, the backup will not be counted as a retained backup and will not be deleted automatically.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               |                                                                                                                                                                                                                                                                    |
      |                       |       -  A maximum of 10 backups are retained for failed periodic backup tasks. They are retained for one month and can be manually deleted.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 |                                                                                                                                                                                                                                                                    |
      +-----------------------+------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+

   .. note::

      More frequent backup intervals create more backups or retain backups for a longer time, protecting data to a greater extent but occupying more storage space. Set an appropriate backup cycle as needed.

#. Click **OK**.

#. Locate the desired vault and choose **More** > **Apply Backup Policy** to apply the created policy to the vault. You can view the applied policy on the vault details page.

   After the policy is applied, data is periodically backed up to the vault based on the policy.

Example
-------

A user has a vault associated with one disk. At 10:00 a.m. on Monday, the user sets a backup policy for the vault, that is, executing a backup task at 02:00 a.m. every day and retaining a maximum of three backups. At 11:00 a.m. on Saturday, three backups are retained, which are generated on Wednesday, Thursday, and Friday. The backup generated at 2:00 a.m. on Tuesday has been automatically deleted.

.. |image1| image:: /_static/images/en-us_image_0159365094.png
.. |image2| image:: /_static/images/en-us_image_0224255894.png
