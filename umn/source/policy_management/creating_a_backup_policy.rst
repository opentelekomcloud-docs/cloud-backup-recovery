:original_name: cbr_03_0025.html

.. _cbr_03_0025:

Creating a Backup Policy
========================

A backup policy allows CBR to automatically back up vaults at specified times or intervals. Periodic backups can be used to restore data quickly against data corruption or loss.

To implement periodic backups, you need a backup policy first. You can use the default backup policy or create one as needed.

Constraints
-----------

-  Backup policies can be applied to the following types of vaults: server backup vaults, disk backup vaults
-  A backup policy must be enabled before it can be used for periodic backups.
-  A maximum of 32 backup policies can be created in each account.
-  When expired backups are deleted, automatic backups will be deleted, but manual backups will not.
-  Only servers in the **Running** or **Stopped** state and disks in the **Available** or **In-use** state can be backed up.
-  CBR by default performs a full backup for a resource in the initial backup and incremental backups in all subsequent backups.

Procedure
---------

#. Log in to CBR Console.

   a. Log in to the management console.
   b. Click |image1| in the upper left corner and select a region.
   c. Click |image2| and choose **Storage** > **Cloud Backup and Recovery**.

#. Choose **Policies** in the left navigation pane and click the **Backup Policies** tab. In the upper right corner, click **Create Policy**. See :ref:`Figure 1 <cbr_03_0025__fig83663164139>`.

   .. _cbr_03_0025__fig83663164139:

   **Figure 1** Creating a backup policy

   |image3|

#. Set the backup policy parameters. :ref:`Table 1 <cbr_03_0025__table18975142115146>` describes the parameters.

   .. _cbr_03_0025__table18975142115146:

   .. table:: **Table 1** Backup policy parameters

      +-----------------------+-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
      | Parameter             | Description                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             | Example Value                                                                                                                                                                                                                                                   |
      +=======================+=========================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================+=================================================================================================================================================================================================================================================================+
      | Type                  | Select a policy type. In this section, we select the backup policy.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     | Backup policy                                                                                                                                                                                                                                                   |
      +-----------------------+-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
      | Name                  | Backup policy name                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      | backup_policy                                                                                                                                                                                                                                                   |
      |                       |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         |                                                                                                                                                                                                                                                                 |
      |                       | A name must contain 1 to 64 characters including digits, letters, underscores (_), or hyphens (-).                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      |                                                                                                                                                                                                                                                                 |
      +-----------------------+-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
      | Status                | Whether to enable the backup policy.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    | Only after a backup policy is enabled and applied will CBR automatically backs up the vault resources and deletes expired backups.                                                                                                                              |
      +-----------------------+-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
      | Execution Time        | Execution time                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          | 00:00, 02:00                                                                                                                                                                                                                                                    |
      |                       |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         |                                                                                                                                                                                                                                                                 |
      |                       | Backups can be scheduled at the beginning of each hour, and you can select multiple hours.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              | -  It is recommended that backups be performed during off-peak hours or when no services are running.                                                                                                                                                           |
      |                       |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         | -  Peak hours of the backup service are from 00:00 to 06:00, during which backup schedules may be delayed. So you are advised to evaluate your service types and schedule backups outside of the backup peak hours.                                             |
      |                       | .. important::                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          |                                                                                                                                                                                                                                                                 |
      |                       |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         |                                                                                                                                                                                                                                                                 |
      |                       |    NOTICE:                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              |                                                                                                                                                                                                                                                                 |
      |                       |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         |                                                                                                                                                                                                                                                                 |
      |                       |    -  There may be a time difference between the scheduled backup time and the actual backup time.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      |                                                                                                                                                                                                                                                                 |
      |                       |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         |                                                                                                                                                                                                                                                                 |
      |                       |    -  If a large amount of data needs to be backed up, you are advised to make backup less frequent to prevent the system from skipping any execution time.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             |                                                                                                                                                                                                                                                                 |
      |                       |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         |                                                                                                                                                                                                                                                                 |
      |                       |       For example, a disk is scheduled to be backed up at 00:00, 01:00, and 02:00. A backup task starts at 00:00. Because a large amount of incremental data needs to be backed up or a heap of backup tasks are executed at the same time, this backup task takes 90 minutes and completes at 01:30. The system performs the next backup at 02:00. In this case, only two backups are generated in total, one at 00:00, and the other at 02:00.                                                                                                                                                                                                                                        |                                                                                                                                                                                                                                                                 |
      |                       |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         |                                                                                                                                                                                                                                                                 |
      |                       |    -  The execution times refer to the local times of clients, not the time zone and times of the region.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               |                                                                                                                                                                                                                                                                 |
      +-----------------------+-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
      | Backup Cycle          | Select a backup cycle.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  | Every day                                                                                                                                                                                                                                                       |
      |                       |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         |                                                                                                                                                                                                                                                                 |
      |                       | -  **Week-based cycle**                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 | If you select day-based backup, the first backup is supposed to be executed on the day when the backup policy is created. If the execution time on the day you create the backup policy has passed, the first backup will be executed in the next backup cycle. |
      |                       |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         |                                                                                                                                                                                                                                                                 |
      |                       |    Specifies on which days of each week the backup task will be executed. You can select multiple days.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 | It is recommended that backups be performed during off-peak hours or when no services are running.                                                                                                                                                              |
      |                       |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         |                                                                                                                                                                                                                                                                 |
      |                       | -  **Custom cycle**                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     |                                                                                                                                                                                                                                                                 |
      |                       |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         |                                                                                                                                                                                                                                                                 |
      |                       |    Specifies the interval (every 1 to 30 days) for executing the backup task.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           |                                                                                                                                                                                                                                                                 |
      +-----------------------+-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
      | Retention Rule        | Rule that specifies how backups will be retained                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        | 6 months                                                                                                                                                                                                                                                        |
      |                       |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         |                                                                                                                                                                                                                                                                 |
      |                       | -  **Time period**                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      |                                                                                                                                                                                                                                                                 |
      |                       |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         |                                                                                                                                                                                                                                                                 |
      |                       |    You can choose to retain backups for one month, three months, six months, one year, or for any desired number (2 to 99999) of days.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  |                                                                                                                                                                                                                                                                 |
      |                       |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         |                                                                                                                                                                                                                                                                 |
      |                       | -  **Backup quantity**                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  |                                                                                                                                                                                                                                                                 |
      |                       |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         |                                                                                                                                                                                                                                                                 |
      |                       |    You can set the maximum number of backups to retain for each resource. The value ranges from 2 to 99999.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             |                                                                                                                                                                                                                                                                 |
      |                       |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         |                                                                                                                                                                                                                                                                 |
      |                       | -  **Advanced Options**                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 |                                                                                                                                                                                                                                                                 |
      |                       |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         |                                                                                                                                                                                                                                                                 |
      |                       |    You can also set long-term retention rules with advanced options. Long-term retention rules and quantity-based retention rules will be both applied.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 |                                                                                                                                                                                                                                                                 |
      |                       |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         |                                                                                                                                                                                                                                                                 |
      |                       |    -  **Day-based**: 0-100                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              |                                                                                                                                                                                                                                                                 |
      |                       |    -  **Weekly**: 0-100                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 |                                                                                                                                                                                                                                                                 |
      |                       |    -  **Monthly**: 0-100                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                |                                                                                                                                                                                                                                                                 |
      |                       |    -  **Yearly**: 0-100                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 |                                                                                                                                                                                                                                                                 |
      |                       |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         |                                                                                                                                                                                                                                                                 |
      |                       |    A resource may be backed up multiple times in a day. If day-based backup is configured, only the most recent backup of that day is retained. If you set **Day-based** to **5**, the most recent backup of each of the last five days that have backups generated will be retained and the earliest backups will be deleted automatically. If day-based, weekly, monthly, and yearly retention rules are all configured, all the rules will apply and the union set of backups will be retained. For example, if **Day-based** is set to **5** and **Weekly** to **1**, five backups will be retained. The long-term retention rule and the quantity-based retention rule both apply. |                                                                                                                                                                                                                                                                 |
      |                       |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         |                                                                                                                                                                                                                                                                 |
      |                       | -  **Permanent**                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        |                                                                                                                                                                                                                                                                 |
      |                       |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         |                                                                                                                                                                                                                                                                 |
      |                       |    .. note::                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            |                                                                                                                                                                                                                                                                 |
      |                       |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         |                                                                                                                                                                                                                                                                 |
      |                       |       -  The system automatically deletes the earliest and expired backups every other day to avoid exceeding the maximum number of backups to retain or retaining any backup longer than the maximum retention period.                                                                                                                                                                                                                                                                                                                                                                                                                                                                 |                                                                                                                                                                                                                                                                 |
      |                       |       -  Expired backups are not deleted right after they are expired. They will be deleted from 12:00 to 00:00 in batches.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             |                                                                                                                                                                                                                                                                 |
      |                       |       -  The retention rules apply only to auto-generated backups, but not manual backups. Manual backups need to be deleted manually.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  |                                                                                                                                                                                                                                                                 |
      |                       |       -  If a backup is used to create an image, the backup will not be deleted by the retention rule.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  |                                                                                                                                                                                                                                                                 |
      |                       |       -  A maximum of 10 backups are retained for failed periodic backup tasks. They are retained for one month and can be deleted manually.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            |                                                                                                                                                                                                                                                                 |
      +-----------------------+-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+

   .. note::

      More frequent backups create more backups or retain backups for a longer time, protecting data to a greater extent but occupying more storage space. Set an appropriate backup frequency as needed.

#. Click **OK**.

   .. note::

      You can locate the desired vault and choose **More** > **Apply Backup Policy** to apply the policy to the vault. Then you can view the applied policy on the vault details page. After the policy is applied, data will be periodically backed up to the vault based on the policy.

Example
-------

At 10:00 a.m. on Monday, a user sets a backup policy for their vault to instruct CBR to execute a backup task at 02:00 a.m. every day and retain a maximum of three backups. As of 11:00 a.m. on Saturday, three backups will be retained, which are generated on Thursday, Friday, and Saturday. The backups generated at 02:00 a.m. on Tuesday and Wednesday have been automatically deleted.

.. |image1| image:: /_static/images/en-us_image_0000001630830957.png
.. |image2| image:: /_static/images/en-us_image_0000001630790433.jpg
.. |image3| image:: /_static/images/en-us_image_0224255894.png
