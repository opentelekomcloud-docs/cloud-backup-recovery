:original_name: CreateCheckpoint.html

.. _CreateCheckpoint:

Creating a Restore Point
========================

Function
--------

This API is used to back up a vault and generate a restore point.

URI
---

POST /v3/{project_id}/checkpoints

.. table:: **Table 1** Path Parameters

   ========== ========= ====== ===========
   Parameter  Mandatory Type   Description
   ========== ========= ====== ===========
   project_id Yes       String Project ID
   ========== ========= ====== ===========

Request Parameters
------------------

.. table:: **Table 2** Request header parameters

   +--------------+-----------+--------+---------------------------------------------------------------------------------------------------------------------------------------------------------------------+
   | Parameter    | Mandatory | Type   | Description                                                                                                                                                         |
   +==============+===========+========+=====================================================================================================================================================================+
   | X-Auth-Token | Yes       | String | User token The token can be obtained by calling the IAM API used to obtain a user token. The value of **X-Subject-Token** in the response header is the user token. |
   +--------------+-----------+--------+---------------------------------------------------------------------------------------------------------------------------------------------------------------------+

.. table:: **Table 3** Request body parameters

   +------------+-----------+-------------------------------------------------------------------+-------------------------------------+
   | Parameter  | Mandatory | Type                                                              | Description                         |
   +============+===========+===================================================================+=====================================+
   | checkpoint | Yes       | :ref:`VaultBackup <createcheckpoint__request_vaultbackup>` object | Parameters for backing up the vault |
   +------------+-----------+-------------------------------------------------------------------+-------------------------------------+

.. _createcheckpoint__request_vaultbackup:

.. table:: **Table 4** VaultBackup

   +------------+-----------+---------------------------------------------------------------------------+-------------+
   | Parameter  | Mandatory | Type                                                                      | Description |
   +============+===========+===========================================================================+=============+
   | parameters | No        | :ref:`CheckpointParam <createcheckpoint__request_checkpointparam>` object | Parameters  |
   +------------+-----------+---------------------------------------------------------------------------+-------------+
   | vault_id   | Yes       | String                                                                    | Vault ID    |
   +------------+-----------+---------------------------------------------------------------------------+-------------+

.. _createcheckpoint__request_checkpointparam:

.. table:: **Table 5** CheckpointParam

   +------------------+-----------------+-----------------------------------------------------------------------+-----------------------------------------------------------------------------------------------------+
   | Parameter        | Mandatory       | Type                                                                  | Description                                                                                         |
   +==================+=================+=======================================================================+=====================================================================================================+
   | auto_trigger     | No              | Boolean                                                               | Whether automatic triggering is enabled. Possible values are **true** (yes) and **false** (no).     |
   |                  |                 |                                                                       |                                                                                                     |
   |                  |                 |                                                                       | Default: **false**                                                                                  |
   +------------------+-----------------+-----------------------------------------------------------------------+-----------------------------------------------------------------------------------------------------+
   | description      | No              | String                                                                | Backup description                                                                                  |
   |                  |                 |                                                                       |                                                                                                     |
   |                  |                 |                                                                       | Minimum: **0**                                                                                      |
   |                  |                 |                                                                       |                                                                                                     |
   |                  |                 |                                                                       | Maximum: **255**                                                                                    |
   +------------------+-----------------+-----------------------------------------------------------------------+-----------------------------------------------------------------------------------------------------+
   | incremental      | No              | Boolean                                                               | Whether the backup is an incremental backup. Possible values are **true** (yes) and **false** (no). |
   |                  |                 |                                                                       |                                                                                                     |
   |                  |                 |                                                                       | Default: **true**                                                                                   |
   +------------------+-----------------+-----------------------------------------------------------------------+-----------------------------------------------------------------------------------------------------+
   | name             | No              | String                                                                | Backup name, which can contain only digits, letters, underscores (_), and hyphens (-)               |
   |                  |                 |                                                                       |                                                                                                     |
   |                  |                 |                                                                       | Minimum: **1**                                                                                      |
   |                  |                 |                                                                       |                                                                                                     |
   |                  |                 |                                                                       | Maximum: **64**                                                                                     |
   +------------------+-----------------+-----------------------------------------------------------------------+-----------------------------------------------------------------------------------------------------+
   | resources        | No              | Array of strings                                                      | UUID list of resources to be backed up                                                              |
   +------------------+-----------------+-----------------------------------------------------------------------+-----------------------------------------------------------------------------------------------------+
   | resource_details | No              | Array of :ref:`Resource <createcheckpoint__request_resource>` objects | Resource details                                                                                    |
   |                  |                 |                                                                       |                                                                                                     |
   |                  |                 |                                                                       | Array Length: **0 - 256**                                                                           |
   +------------------+-----------------+-----------------------------------------------------------------------+-----------------------------------------------------------------------------------------------------+

.. _createcheckpoint__request_resource:

.. table:: **Table 6** Resource

   +-----------------+-----------------+-------------------------------------------------------------------------------+------------------------------------------------------------------------------------------------------------------------+
   | Parameter       | Mandatory       | Type                                                                          | Description                                                                                                            |
   +=================+=================+===============================================================================+========================================================================================================================+
   | extra_info      | No              | :ref:`ResourceExtraInfo <createcheckpoint__request_resourceextrainfo>` object | Vault name                                                                                                             |
   +-----------------+-----------------+-------------------------------------------------------------------------------+------------------------------------------------------------------------------------------------------------------------+
   | id              | Yes             | String                                                                        | ID of the vault resource type                                                                                          |
   +-----------------+-----------------+-------------------------------------------------------------------------------+------------------------------------------------------------------------------------------------------------------------+
   | name            | No              | String                                                                        | Name of the resource to be backed up. The value consists of 0 to 255 characters.                                       |
   |                 |                 |                                                                               |                                                                                                                        |
   |                 |                 |                                                                               | Minimum: **0**                                                                                                         |
   |                 |                 |                                                                               |                                                                                                                        |
   |                 |                 |                                                                               | Maximum: **255**                                                                                                       |
   +-----------------+-----------------+-------------------------------------------------------------------------------+------------------------------------------------------------------------------------------------------------------------+
   | type            | Yes             | String                                                                        | Type of the resource to be backed up, which can be **OS::Nova::Server**, **OS::Cinder::Volume**, or **OS::Sfs::Turbo** |
   +-----------------+-----------------+-------------------------------------------------------------------------------+------------------------------------------------------------------------------------------------------------------------+

.. _createcheckpoint__request_resourceextrainfo:

.. table:: **Table 7** ResourceExtraInfo

   +-----------------+-----------+------------------+---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
   | Parameter       | Mandatory | Type             | Description                                                                                                                                                                                                                                                                                 |
   +=================+===========+==================+=============================================================================================================================================================================================================================================================================================+
   | exclude_volumes | No        | Array of strings | IDs of the disks that will not be backed up. This parameter is used when servers are added to a vault, which include all server disks. But some disks do not need to be backed up. Or in case that a server was previously added and some disks on this server do not need to be backed up. |
   +-----------------+-----------+------------------+---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+

Response Parameters
-------------------

**Status code: 200**

.. table:: **Table 8** Response body parameters

   +------------+------------------------------------------------------------------------------+---------------------------+
   | Parameter  | Type                                                                         | Description               |
   +============+==============================================================================+===========================+
   | checkpoint | :ref:`CheckpointCreate <createcheckpoint__response_checkpointcreate>` object | Restore point information |
   +------------+------------------------------------------------------------------------------+---------------------------+

.. _createcheckpoint__response_checkpointcreate:

.. table:: **Table 9** CheckpointCreate

   +-----------------------+--------------------------------------------------------------------------------------------+------------------------------------------------------------+
   | Parameter             | Type                                                                                       | Description                                                |
   +=======================+============================================================================================+============================================================+
   | created_at            | String                                                                                     | Creation time, for example, **2020-02-05T10:38:34.209782** |
   +-----------------------+--------------------------------------------------------------------------------------------+------------------------------------------------------------+
   | id                    | String                                                                                     | Restore point ID                                           |
   +-----------------------+--------------------------------------------------------------------------------------------+------------------------------------------------------------+
   | project_id            | String                                                                                     | Project ID                                                 |
   +-----------------------+--------------------------------------------------------------------------------------------+------------------------------------------------------------+
   | status                | String                                                                                     | Status                                                     |
   |                       |                                                                                            |                                                            |
   |                       |                                                                                            | Enumeration values:                                        |
   |                       |                                                                                            |                                                            |
   |                       |                                                                                            | -  **available**                                           |
   |                       |                                                                                            |                                                            |
   |                       |                                                                                            | -  **deleting**                                            |
   |                       |                                                                                            |                                                            |
   |                       |                                                                                            | -  **protecting**                                          |
   |                       |                                                                                            |                                                            |
   |                       |                                                                                            | -  **deleted**                                             |
   |                       |                                                                                            |                                                            |
   |                       |                                                                                            | -  **error-deleting**                                      |
   |                       |                                                                                            |                                                            |
   |                       |                                                                                            | -  **error**                                               |
   +-----------------------+--------------------------------------------------------------------------------------------+------------------------------------------------------------+
   | vault                 | :ref:`CheckpointPlanCreate <createcheckpoint__response_checkpointplancreate>` object       | Vault information                                          |
   +-----------------------+--------------------------------------------------------------------------------------------+------------------------------------------------------------+
   | extra_info            | :ref:`CheckpointExtraInfoResp <createcheckpoint__response_checkpointextrainforesp>` object | Extended information                                       |
   +-----------------------+--------------------------------------------------------------------------------------------+------------------------------------------------------------+

.. _createcheckpoint__response_checkpointplancreate:

.. table:: **Table 10** CheckpointPlanCreate

   +-------------------+----------------------------------------------------------------------------------------------------------------------+---------------------------------+
   | Parameter         | Type                                                                                                                 | Description                     |
   +===================+======================================================================================================================+=================================+
   | id                | String                                                                                                               | Vault ID                        |
   +-------------------+----------------------------------------------------------------------------------------------------------------------+---------------------------------+
   | name              | String                                                                                                               | Vault name                      |
   +-------------------+----------------------------------------------------------------------------------------------------------------------+---------------------------------+
   | resources         | Array of :ref:`CheckpointResourceResp <createcheckpoint__response_checkpointresourceresp>` objects                   | Backup objects                  |
   +-------------------+----------------------------------------------------------------------------------------------------------------------+---------------------------------+
   | skipped_resources | Array of :ref:`CheckpointCreateSkippedResource <createcheckpoint__response_checkpointcreateskippedresource>` objects | Resources skipped during backup |
   +-------------------+----------------------------------------------------------------------------------------------------------------------+---------------------------------+

.. _createcheckpoint__response_checkpointresourceresp:

.. table:: **Table 11** CheckpointResourceResp

   +-----------------------+-----------------------+------------------------------------------------------------------------------------------------------------------------+
   | Parameter             | Type                  | Description                                                                                                            |
   +=======================+=======================+========================================================================================================================+
   | extra_info            | String                | Extra information of the resource                                                                                      |
   +-----------------------+-----------------------+------------------------------------------------------------------------------------------------------------------------+
   | id                    | String                | ID of the resource to be backed up                                                                                     |
   +-----------------------+-----------------------+------------------------------------------------------------------------------------------------------------------------+
   | name                  | String                | Name of the resource to be backed up                                                                                   |
   +-----------------------+-----------------------+------------------------------------------------------------------------------------------------------------------------+
   | protect_status        | String                | Protected status                                                                                                       |
   |                       |                       |                                                                                                                        |
   |                       |                       | Enumeration values:                                                                                                    |
   |                       |                       |                                                                                                                        |
   |                       |                       | -  **available**                                                                                                       |
   |                       |                       |                                                                                                                        |
   |                       |                       | -  **error**                                                                                                           |
   |                       |                       |                                                                                                                        |
   |                       |                       | -  **protecting**                                                                                                      |
   |                       |                       |                                                                                                                        |
   |                       |                       | -  **restoring**                                                                                                       |
   |                       |                       |                                                                                                                        |
   |                       |                       | -  **removing**                                                                                                        |
   +-----------------------+-----------------------+------------------------------------------------------------------------------------------------------------------------+
   | resource_size         | String                | Allocated capacity for the associated resource, in GB                                                                  |
   +-----------------------+-----------------------+------------------------------------------------------------------------------------------------------------------------+
   | type                  | String                | Type of the resource to be backed up, which can be **OS::Nova::Server**, **OS::Cinder::Volume**, or **OS::Sfs::Turbo** |
   +-----------------------+-----------------------+------------------------------------------------------------------------------------------------------------------------+
   | backup_size           | String                | Backup size                                                                                                            |
   +-----------------------+-----------------------+------------------------------------------------------------------------------------------------------------------------+
   | backup_count          | String                | Number of backups                                                                                                      |
   +-----------------------+-----------------------+------------------------------------------------------------------------------------------------------------------------+

.. _createcheckpoint__response_checkpointcreateskippedresource:

.. table:: **Table 12** CheckpointCreateSkippedResource

   +-----------+--------+------------------------------------------------------------------------+
   | Parameter | Type   | Description                                                            |
   +===========+========+========================================================================+
   | id        | String | Resource ID                                                            |
   +-----------+--------+------------------------------------------------------------------------+
   | type      | String | Resource type                                                          |
   +-----------+--------+------------------------------------------------------------------------+
   | name      | String | Resource name                                                          |
   +-----------+--------+------------------------------------------------------------------------+
   | code      | String | For details, see :ref:`Error Codes <errorcode>`.                       |
   +-----------+--------+------------------------------------------------------------------------+
   | reason    | String | Reason for the skipping. For example, the resource is being backed up. |
   +-----------+--------+------------------------------------------------------------------------+

.. _createcheckpoint__response_checkpointextrainforesp:

.. table:: **Table 13** CheckpointExtraInfoResp

   ================== ======= ===========================================
   Parameter          Type    Description
   ================== ======= ===========================================
   name               String  Backup name
   description        String  Backup description
   retention_duration Integer Number of days that backups can be retained
   ================== ======= ===========================================

Example Requests
----------------

Creating backups

.. code-block:: text

   POST https://{endpoint}/v3/f841e01fd2b14e7fa41b6ae7aa6b0594/checkpoints

   {
     "checkpoint" : {
       "parameters" : {
         "auto_trigger" : true,
         "description" : "backup_description",
         "incremental" : true,
         "name" : "backup_name",
         "resources" : [ "94eba8b2-acc9-4d82-badc-127144cc5526" ]
       },
       "vault_id" : "3b5816b5-f29c-4172-9d9a-76c719a659ce"
     }
   }

Example Responses
-----------------

**Status code: 200**

OK

.. code-block::

   {
     "checkpoint" : {
       "status" : "protecting",
       "created_at" : "2019-05-10T07:59:12.733403",
       "vault" : {
         "skipped_resources" : [ ],
         "id" : "3b5816b5-f29c-4172-9d9a-76c719a659ce",
         "resources" : [ {
           "name" : "ecs-1f0f-0002",
           "resource_size" : "40",
           "protect_status" : "available",
           "type" : "OS::Nova::Server",
           "id" : "94eba8b2-acc9-4d82-badc-127144cc5526",
           "extra_info" : null
         } ],
         "name" : "vault-be94"
       },
       "project_id" : "4229d7a45436489f8c3dc2b1d35d4987",
       "id" : "8b0851a8-adf3-4f4c-a914-dead08bf9664",
       "extra_info" : {
         "retention_duration" : -1,
         "name" : "backup_name",
         "description" : "backup_description"
       }
     }
   }

Status Codes
------------

=========== ===========
Status Code Description
=========== ===========
200         OK
=========== ===========

Error Codes
-----------

See :ref:`Error Codes <errorcode>`.
